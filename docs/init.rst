.. _init:

*************
Система инициализации 
*************

В жизни каждого администратора АПКШ Континент наступает тот момент, когда он
хочет написать свой скрипт и затюнить континет. Для того, чтобы Континет мог
запустить скрипт необходимо понимать принцип работы системы инициализации.
.. note::

   В UNIX система инициализации это процесс, запускаемый с PID 1, котрый
   управляет процессом запуска прикладного и системного ПО.

Система инициализации выполянет следующие функции:

   * установка параметров ядра
   * монтирование файловых систем
   * запуск демонов Континета

Нас больше всего интересует именно последня функция, ведь мы хотим запускать
свои скрипты.

Итак, система иницицализации оперирует тремя директориями, в которых
располгаются исполняемые файлы (скрипты или бинарные файлы):
  * /etc/rc.startup
  * /etc/rc.running
  * /etc/rc.final

Директория rc.startup предназначена для размещения файлов, запускаемых при
старте Континета, после монтирования файловых систем и до запуска основных
демонов. Тут как раз размещаются символьные ссылки на запуск меню,
появляющемуся при нажатии Enter и утилиты расчета общей контрольной суммы,
которую можно увидеть в свойствах устройства при работе в ПУ ЦУС. Запуск файлов
из этой директории выполняется последовательно.

Директория rc.running предназначена для размещения файлов, которые являются
основными демонами Континента. Тут запускаются agent, netcenter, cgw_logger,
snmpd, dhcpd и так далее. В версии debug тут так же размещаются ссимвольные
ссылки на скрпты запуска SSH-демона и выделенных консолей с /bin/sh (tty2 и
tty3), переход на которые возможен по сочетанию клавищ Alt+{F3|F4}. Порядок и
наименование файлов здесь отвечают за порядок запуска на выделенных консолях
tty, начиная со второй консоли, поскольку первая остается для сообщений ядра и
надписи "Успешный запуск".

В директории rc.final содержатся файлы, запускаемые системой инициализации при
перезагрузке или выключении устройства.

Система инициализаци устроена очень занятно, как она понимает как ей следует
запустить процесс? А по наличию в конце файла специальных симовлов режима
запуска, которые могут быть комбинированными.

.. attention::

   Бкз указания явного режима перезапуска демона в случае гибели или остановки
   процесса система инициализации отправит Континет в перезагрузка, помните
   сообщение о том, что завершился 3agent? Вот это оно.

Режимы запуска:
  * '+' - перезапустить процесс, в случае его гибели или завершения
  * '-' - запустить демон на выделенной консоли tty. Порядок файлов в
  * директории будет сообтвествовать порядку консолей
  * '~' - специальный режим для запуска оболочки /bin/sh
  * '.' - режим запуска с задержкой
  * '%' -  режим игнорирования, система инициализации не будет отслеживать
  * сотсояние процесса
  * '=' - специальный режим запуска на serial-консоли 

Пример
======

Допустим мы хотим запустить top, расположенный по пути /bin/top на выделенной
консоли. Для этого выполним следующие команды:  
:guilabel:`ln -s /bin/top /etc/rc.running/00Atop+-`  
:guilabel:`reboot`  

Все, наш top будет запушен на второй консоли, на которую можно будет попасть по
сочетанию клавиш Alt+F2.

